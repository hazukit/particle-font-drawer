!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["particle-font-drawer"]=e():t["particle-font-drawer"]=e()}(self,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{PirticleFontDrawer:()=>a});const s=(t=0,e=100)=>Math.floor(Math.random()*(e-t+1))+t,i={common:{rgbToHex:(t,e,s)=>((1<<24)+(t<<16)+(e<<8)+s).toString(16).slice(1),hexToRgb(t){const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e,a:255}},rgbaToHex(t,e,s,i){let n=(t<<24)+(e<<16)+(s<<8)+i;return n<0&&(n=4294967295+n+1),n.toString(16).padStart(8,"0")},hexToRgba(t){const e=parseInt(t,16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:255&e}},colorToHex(t){return"#"===t.charAt(0)&&(t=t.substr(1)),8===t.length?this.hexToRgba(t):this.hexToRgb(t)},getImageBytes:t=>new Promise(((e,s)=>{const i=new Image;i.src=t,i.onload=()=>{const t=document.createElement("canvas");t.width=i.width,t.height=i.height;const s=t.getContext("2d");s.drawImage(i,0,0);const n=s.getImageData(0,0,i.width,i.height);e(n)},i.onerror=s}))}};class n{constructor(t,e={},s=null,i=()=>{}){this.texts=t.split("\n"),this.fontStyles=e,this.fontText=this.getText(e),this.fontUrl=s,this.completeFunc=i,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}load(){this.fontUrl?this.loadWebFont(this.fontUrl).then((()=>{this.initCanvas(),this.renderText(),this.completeFunc()})).catch((()=>{console.error("Failed to load the font."),this.completeFunc()})):(this.initCanvas(),this.renderText(),this.completeFunc())}getText(t){const{"font-style":e="normal","font-variant":s="normal","font-weight":i="normal","font-size":n="16px","font-family":o="Arial"}=t;return`${e} ${s} ${i} ${n} ${o}`}getTextSize(t){const e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.font=this.fontText,e.innerHTML=t,document.body.appendChild(e);const s=[e.clientWidth,e.clientHeight];return document.body.removeChild(e),s}initCanvas(){const[t,e]=this.calculateCanvasSize();this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.context.textBaseline="top",this.context.textAlign="left",this.context.fillStyle="red"}calculateCanvasSize(){let t=0,e=0;for(const s of this.texts){const[i,n]=this.getTextSize(s);i>t&&(t=i),e+=n}return[t,e]}loadWebFont(t,e){return new Promise(((s,i)=>{const n=document.createElement("link");n.href=t,n.rel="stylesheet",document.head.appendChild(n),document.fonts.load(`1em ${e}`).then((()=>{s()})).catch((t=>{i(t)}))}))}getFontSize(t){const e=t.font;return parseInt(e.match(/\d+px/)[0],10)}renderText(){let t=-1e3;for(const e of this.texts){if(this.context.font=this.fontText,-1e3==t){const s=this.context.measureText(e);t=this.getFontSize(this.context)-s.fontBoundingBoxDescent}this.context.fillText(e,0,t),t+=this.getTextSize(e)[1]}}}class o{constructor(t,e,s){this.x=t,this.y=e,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.tx=0,this.ty=0,this.rgba=s,this.damp=0,this.homeForce=0,this.next=null}init(){}setBaseLocation(t,e){this.tx=t,this.ty=e}update(){if(this.vx+=this.ax,this.vy+=this.ay,Math.abs(this.vx)<.005&&Math.abs(this.vy)<.005)return this.x=this.tx,this.y=this.ty,this.vx=0,this.vy=0,this.ax=0,void(this.ay=0);this.x+=this.vx,this.y+=this.vy,this.ax=0,this.ay=0}addForce(t,e,s,i){const n=t-this.x,o=e-this.y;let h=n*n+o*o;if(h<s*s){const t=Math.sqrt(h),e=t/s-1;this.ax+=n/t*i*e,this.ay+=o/t*i*e}}seekHome(){const t=this.tx-this.x,e=this.ty-this.y;this.ax+=t*this.homeForce,this.ay+=e*this.homeForce}addDamping(){this.ax+=(this.ax-this.vx)*this.damp,this.ay+=(this.ay-this.vy)*this.damp}}class h{constructor(t,e,s,i,n){this.canvas=t,this.onMove=e,this.onDown=s,this.onUp=i,this.onLeave=n,this.scale=this.getCanvasScale(this.canvas),this.setupEvents(),new ResizeObserver((()=>{this.resizeCanvas()})).observe(this.canvas)}setupEvents(){"ontouchstart"in window||navigator.maxTouchPoints>0?(this.canvas.addEventListener("touchmove",this.handleMove.bind(this),!1),this.canvas.addEventListener("touchstart",this.handleDown.bind(this),!1),this.canvas.addEventListener("touchend",this.handleUpAndLeave.bind(this),!1),this.canvas.addEventListener("touchcancel",this.handleLeave.bind(this),!1)):(this.canvas.addEventListener("mousemove",this.handleMove.bind(this),!1),this.canvas.addEventListener("mousedown",this.handleDown.bind(this),!1),this.canvas.addEventListener("mouseup",this.handleUp.bind(this),!1),this.canvas.addEventListener("mouseout",this.handleLeave.bind(this),!1))}getCanvasScale(t){const e=t.getBoundingClientRect();return{scaleX:t.width/e.width,scaleY:t.height/e.height}}resizeCanvas(t){this.scale=this.getCanvasScale(this.canvas)}handleMove(t){if(this.onMove){const e=this.getEventPosition(t);this.onMove(e.x*this.scale.scaleX,e.y*this.scale.scaleY)}}handleDown(t){const e=this.getEventPosition(t);this.onDown&&this.onDown(e.x*this.scale.scaleX,e.y*this.scale.scaleY)}handleUp(t){this.onUp&&this.onUp()}handleUpAndLeave(t){this.onUp&&this.onUp(),this.onLeave&&this.onLeave()}handleLeave(t){this.onLeave&&this.onLeave()}getEventPosition(t){const e=this.canvas.getBoundingClientRect();let s,i;return t.touches&&t.touches.length>0?(s=t.touches[0].clientX-e.left,i=t.touches[0].clientY-e.top):(s=t.clientX-e.left,i=t.clientY-e.top),{x:s,y:i}}}class a{constructor(t,e,s={}){const h={dotClass:o,textColor:"#000000",offsetX:0,offsetY:0,fontStyles:{},dampForceRange:[5,15],homeForceRange:[3,9],fontUrl:null,textureUrl:null,force:3,clickedForce:200,isClickedDamp:!0,radius:50,firstBound:!0};Object.assign(this,h,s),this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.width=this.canvas.width,this.height=this.canvas.height,this.mouseX=-1e3,this.mouseY=-1e3,this.dots=[],this.rgba=i.common.colorToHex(this.textColor);const a=new n(e,this.fontStyles,this.fontUrl,(()=>{this.loadFontAndCreateDots(a)}));a.load()}loadFontAndCreateDots(t){this.textureUrl?i.common.getImageBytes(this.textureUrl).then((e=>{this.createDotsFromCanvasFont(t,e),this.startAnimation()})).catch((()=>{console.error("Texture loading failed.")})):(this.createDotsFromCanvasFont(t,null),this.startAnimation())}createDotsFromCanvasFont(t,e){const i=t.context.getImageData(0,0,t.width,t.height),{width:n,height:o}=t,{offsetX:h,offsetY:a,dampForceRange:r,homeForceRange:c}=this;let d=null;for(let t=0;t<n;t++)for(let l=0;l<o;l++){const u=4*(t+l*n),m=i.data[u+3];if(m>0){const i=this.getRgbColor(e,t,l,m),u=this.firstBound?new this.dotClass(s(h,n+h),s(a,o+a),i):new this.dotClass(h+t,a+l,i);u.init(),u.damp=s(r[0],r[1])/100,u.homeForce=s(c[0],c[1])/1e3,u.setBaseLocation(h+t,a+l),this.dots.push(u),d&&(d.next=u),d=u}}}getRgbColor(t,e,s,i){if(!t)return{r:this.rgba.r,g:this.rgba.g,b:this.rgba.b,a:i};const n=4*(e+s*t.width);return{r:t.data[n],g:t.data[n+1],b:t.data[n+2],a:i}}startAnimation(){requestAnimationFrame(this.tick.bind(this)),new h(this.canvas,this.onMouseMove.bind(this),this.onMouseDown.bind(this),null,this.onMouseOut.bind(this))}onMouseMove(t,e){this.mouseX=t,this.mouseY=e}onMouseOut(){this.mouseX=-1e3,this.mouseY=-1e3}onMouseDown(t,e){this.mouseX=t,this.mouseY=e,this.isClickedDamp&&(this.isMouseDown=!0)}tick(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx.getImageData(0,0,this.width,this.height),e=this.isMouseDown?this.clickedForce:this.force;this.isMouseDown=!1,this.dots.forEach((s=>{s.addForce(this.mouseX,this.mouseY,this.radius,e),s.seekHome(),s.addDamping(),s.update(),this.drawDot(s,t)})),this.ctx.putImageData(t,0,0),requestAnimationFrame(this.tick.bind(this))}drawDot(t,e){const{x:s,y:i,rgba:n}=t;if(s<0||i<0||s>=this.width||i>=this.height)return;const o=4*(parseInt(s)+parseInt(i)*this.width);e.data[o]=n.r,e.data[o+1]=n.g,e.data[o+2]=n.b,e.data[o+3]=n.a}}return e})()));