!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["particle-font-drawer"]=e():t["particle-font-drawer"]=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{PirticleFontDrawer:()=>k});var n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Math.floor(Math.random()*(e-t+1))+t},i={common:{rgbToHex:function(t,e,n){return((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1)},hexToRgb:function(t){var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e,a:255}},rgbaToHex:function(t,e,n,i){var o=(t<<24)+(e<<16)+(n<<8)+i;return o<0&&(o=4294967295+o+1),o.toString(16).padStart(8,"0")},hexToRgba:function(t){var e=parseInt(t,16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:255&e}},colorToHex:function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),8===t.length?this.hexToRgba(t):this.hexToRgb(t)},getImageBytes:function(t){return new Promise((function(e,n){var i=new Image;i.src=t,i.onload=function(){var t=document.createElement("canvas");t.width=i.width,t.height=i.height;var n=t.getContext("2d");n.drawImage(i,0,0);var o=n.getImageData(0,0,i.width,i.height);e(o)},i.onerror=n}))},getFontSize:function(t){return parseInt(t.match(/\d+px/)[0],10)}}};function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(h)throw r}}}}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,a,s=[],h=!0,u=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;h=!1}else for(;!(h=(i=r.call(n)).done)&&(s.push(i.value),s.length!==e);h=!0);}catch(t){u=!0,o=t}finally{try{if(!h&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return h(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,c(i.key),i)}}function c(t){var e=function(t){if("object"!=o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}var l=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.texts=e.split("\n"),this.fontStyles=n,this.fontText=this.getText(n),this.completeFunc=i,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")},(e=[{key:"load",value:function(){this.initCanvas(),this.renderText(),this.completeFunc()}},{key:"getText",value:function(t){var e=t["font-style"],n=void 0===e?"normal":e,i=t["font-variant"],o=void 0===i?"normal":i,r=t["font-weight"],a=void 0===r?"normal":r,s=t["font-size"],h=void 0===s?"16px":s,u=t["font-family"],c=void 0===u?"Arial":u;return"".concat(n," ").concat(o," ").concat(a," ").concat(h," ").concat(c)}},{key:"getTextSize",value:function(t){var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.font=this.fontText,e.innerHTML=t,document.body.appendChild(e);var n=[e.clientWidth,e.clientHeight];return document.body.removeChild(e),n}},{key:"initCanvas",value:function(){var t=a(this.calculateCanvasSize(),2),e=t[0],n=t[1];this.width=e,this.height=n,this.canvas.width=e,this.canvas.height=n,this.context.textBaseline="top",this.context.textAlign="left",this.context.fillStyle="red"}},{key:"calculateCanvasSize",value:function(){var t,e=0,n=0,i=r(this.texts);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=a(this.getTextSize(o),2),h=s[0],u=s[1];h>e&&(e=h),n+=u}}catch(t){i.e(t)}finally{i.f()}return[e,n]}},{key:"renderText",value:function(){var t,e=-1e3,n=r(this.texts);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(this.context.font=this.fontText,-1e3==e){var a=this.context.measureText(o);e=i.common.getFontSize(this.fontText)-a.fontBoundingBoxDescent}this.context.fillText(o,0,e),e+=this.getTextSize(o)[1]}}catch(t){n.e(t)}finally{n.f()}}}])&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,y(i.key),i)}}function y(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}var d=function(){return t=function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.tx=0,this.ty=0,this.rgba=i,this.damp=0,this.homeForce=0,this.next=null},(e=[{key:"init",value:function(){}},{key:"setBaseLocation",value:function(t,e){this.tx=t,this.ty=e}},{key:"update",value:function(){if(this.vx+=this.ax,this.vy+=this.ay,Math.abs(this.vx)<.005&&Math.abs(this.vy)<.005)return this.x=this.tx,this.y=this.ty,this.vx=0,this.vy=0,this.ax=0,void(this.ay=0);this.x+=this.vx,this.y+=this.vy,this.ax=0,this.ay=0}},{key:"addForce",value:function(t,e,n,i){var o=t-this.x,r=e-this.y,a=o*o+r*r;if(a<n*n){var s=Math.sqrt(a),h=s/n-1;this.ax+=o/s*i*h,this.ay+=r/s*i*h}}},{key:"seekHome",value:function(){var t=this.tx-this.x,e=this.ty-this.y;this.ax+=t*this.homeForce,this.ay+=e*this.homeForce}},{key:"addDamping",value:function(){this.ax+=(this.ax-this.vx)*this.damp,this.ay+=(this.ay-this.vy)*this.damp}}])&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,p(i.key),i)}}function p(t){var e=function(t){if("object"!=m(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m(e)?e:e+""}var g=function(){return t=function t(e,n,i,o,r){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.onMove=n,this.onDown=i,this.onUp=o,this.onLeave=r,this.scale=this.getCanvasScale(this.canvas),this.setupEvents(),new ResizeObserver((function(){a.resizeCanvas()})).observe(this.canvas)},(e=[{key:"setupEvents",value:function(){"ontouchstart"in window||navigator.maxTouchPoints>0?(this.canvas.addEventListener("touchmove",this.handleMove.bind(this),{passive:!0}),this.canvas.addEventListener("touchstart",this.handleDown.bind(this),{passive:!0}),this.canvas.addEventListener("touchend",this.handleUpAndLeave.bind(this),{passive:!0}),this.canvas.addEventListener("touchcancel",this.handleLeave.bind(this),{passive:!0})):(this.canvas.addEventListener("mousemove",this.handleMove.bind(this),!1),this.canvas.addEventListener("mousedown",this.handleDown.bind(this),!1),this.canvas.addEventListener("mouseup",this.handleUp.bind(this),!1),this.canvas.addEventListener("mouseout",this.handleLeave.bind(this),!1))}},{key:"getCanvasScale",value:function(t){var e=t.getBoundingClientRect();return{scaleX:t.width/e.width,scaleY:t.height/e.height}}},{key:"resizeCanvas",value:function(t){this.scale=this.getCanvasScale(this.canvas)}},{key:"handleMove",value:function(t){if(this.onMove){var e=this.getEventPosition(t);this.onMove(e.x*this.scale.scaleX,e.y*this.scale.scaleY)}}},{key:"handleDown",value:function(t){var e=this.getEventPosition(t);this.onDown&&this.onDown(e.x*this.scale.scaleX,e.y*this.scale.scaleY)}},{key:"handleUp",value:function(t){this.onUp&&this.onUp()}},{key:"handleUpAndLeave",value:function(t){this.onUp&&this.onUp(),this.onLeave&&this.onLeave()}},{key:"handleLeave",value:function(t){this.onLeave&&this.onLeave()}},{key:"getEventPosition",value:function(t){var e,n,i=this.canvas.getBoundingClientRect();return t.touches&&t.touches.length>0?(e=t.touches[0].clientX-i.left,n=t.touches[0].clientY-i.top):(e=t.clientX-i.left,n=t.clientY-i.top),{x:e,y:n}}}])&&b(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,S(i.key),i)}}function S(t){var e=function(t){if("object"!=x(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==x(e)?e:e+""}var k=function(){return t=function t(e,n){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var a={dotClass:d,textColor:"#000000",offsetX:0,offsetY:0,fontStyles:{},dampForceRange:[5,15],homeForceRange:[3,9],textureUrl:null,force:3,clickedForce:200,isClickedDamp:!0,radius:50,firstBound:!0};Object.assign(this,a,r),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.width=this.canvas.width,this.height=this.canvas.height,this.mouseX=-1e3,this.mouseY=-1e3,this.dots=[],this.rgba=i.common.colorToHex(this.textColor),this.isMouseDown=!1;var s=new l(n,this.fontStyles,(function(){o.loadFontAndCreateDots(s)}));s.load()},(e=[{key:"loadFontAndCreateDots",value:function(t){var e=this;this.textureUrl?i.common.getImageBytes(this.textureUrl).then((function(n){e.createDotsFromCanvasFont(t,n),e.startAnimation()})).catch((function(){console.error("Texture loading failed.")})):(this.createDotsFromCanvasFont(t,null),this.startAnimation())}},{key:"createDotsFromCanvasFont",value:function(t,e){for(var i=t.context.getImageData(0,0,t.width,t.height),o=t.width,r=t.height,a=this.offsetX,s=this.offsetY,h=this.dampForceRange,u=this.homeForceRange,c=null,l=0;l<o;l++)for(var f=0;f<r;f++){var v=4*(l+f*o),y=i.data[v+3];if(y>0){var d=this.getRgbColor(e,l,f,y),m=this.firstBound?new this.dotClass(n(a,o+a),n(s,r+s),d):new this.dotClass(a+l,s+f,d);m.init(),m.damp=n(h[0],h[1])/100,m.homeForce=n(u[0],u[1])/1e3,m.setBaseLocation(a+l,s+f),this.dots.push(m),c&&(c.next=m),c=m}}}},{key:"getRgbColor",value:function(t,e,n,i){if(!t)return{r:this.rgba.r,g:this.rgba.g,b:this.rgba.b,a:i};var o=4*(e+n*t.width);return{r:t.data[o],g:t.data[o+1],b:t.data[o+2],a:i}}},{key:"startAnimation",value:function(){requestAnimationFrame(this.tick.bind(this)),new g(this.canvas,this.onMouseMove.bind(this),this.onMouseDown.bind(this),null,this.onMouseOut.bind(this))}},{key:"onMouseMove",value:function(t,e){this.mouseX=t,this.mouseY=e}},{key:"onMouseOut",value:function(){this.mouseX=-1e3,this.mouseY=-1e3}},{key:"onMouseDown",value:function(t,e){this.mouseX=t,this.mouseY=e,this.isClickedDamp&&(this.isMouseDown=!0)}},{key:"tick",value:function(){var t=this;this.ctx.clearRect(0,0,this.width,this.height);var e=this.ctx.getImageData(0,0,this.width,this.height),n=this.isMouseDown?this.clickedForce:this.force;this.isMouseDown=!1,this.dots.forEach((function(i){i.addForce(t.mouseX,t.mouseY,t.radius,n),i.seekHome(),i.addDamping(),i.update(),t.drawDot(i,e)})),this.ctx.putImageData(e,0,0),requestAnimationFrame(this.tick.bind(this))}},{key:"drawDot",value:function(t,e){var n=t.x,i=t.y,o=t.rgba;if(!(n<0||i<0||n>=this.width||i>=this.height)){var r=4*(parseInt(n)+parseInt(i)*this.width);e.data[r]=o.r,e.data[r+1]=o.g,e.data[r+2]=o.b,e.data[r+3]=o.a}}}])&&w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();return e})()));